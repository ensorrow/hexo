title: 前端性能优化：图片篇
date: 2016-05-05 22:30:19
tags: [EUX,前端性能]
---

前端图片优化的问题一直以来都是热门话题，从需求上来看，很多的站点往往是图片体积大于代码体积，图片请求多于代码文件请求，给前端的性能带来了很大的困扰。那么解决方案呢？🌚

### 一.雪碧图+图片压缩

什么是雪碧图呢，雪碧图即css sprites，是一种把一堆小图片拼成一张大图的简单粗暴的技术，拼完以后前端所有要用到图片的地方使用css背景图片、通过背景定位来展示对应的图片。优势呢，就是减少了一大堆http请求，这个时候缺点就很明显了🌚，由于需要使用背景图片定位，图片大小最好得是确定的（不确定的话就用rem来算），然后还有起一大堆不同的class名来区分各个图片，逼死起名困难症🌚。

图片压缩就很简单粗暴了，无损压缩嘛，还有切图格式的问题

>- 优先用 png 而不是 gif
- 压缩 png
- 去掉 jpg 的 metadata
- 压缩 gif 动画
- 尝试使用 png8
- 避免使用 AlphaImageLoader
- 压缩动态生成的图像
- 使 favicon 更小 可缓存
- 使用 CSS Sprites

### 二.base64

base64是个什么东西呢？看一看用法就明白了

    <img src="data:imagegif;base64,AAAA">
    //或者像这样，在css里
    background-image: url(data:imagegif;base64,AAAA)

图片的编码已经在base64编码里了，浏览器解析出来那段代码就成功加载了那张图片，一般来说base6编码的大小比原图大小要稍大些，那用它的优势在哪呢🌚，还是减少http请求，性能方面的话，自己衡量一下是那点带宽影响更大还是额外请求影响更大再决定用不用吧。

### 三.响应式图片

为了得到更好的显示效果，一般我们会使用更加高清的图片然后设置`max-width:100%`，不可避免的图片会很大，那么如果我的设备屏幕实际上很小，那就完全没必要加载那么大的图片了，小的就可以满足清晰度要求，这个时候就要使用到响应式图片。

主要用到的其实就是srcset属性和sizes属性，看一个小的demo

	<img src="image1.jpg" srcset="image2.jpg 256w,image1.jpg 512w" sizes="(min-width: 36em) 33.3vw,
        100vw">

其中的256w和512w作为对应图片链接的描述符，一般使用128w,256w,512w分别对应1x,2x,3x屏幕，至于后面的sizes，括号内容表示媒体查询条件，第一个为满足条件的尺寸，第二个为不满足条件尺寸。**图片只在页面加载时根据屏幕像素密度和viewport宽度加载**，与css响应式是不一样的。

### 四.延迟加载

假设我的网页很长很长，图片很多很多（比如多图慎点那种），但是我可能看了一下就没兴趣了，那是不是完全没有必要加载后面的图片了，这个时候就要有一个延迟加载的思想。

图片延迟加载也称懒加载，通常应用于图片比较多的网页，如果一个页面图片比较多，且页面高度或宽度有好几屏，页面初次加载时，只显示可视区域的图片（非可视区域图片使用1*1的图片占位，图片大小css控制），当页面滚动的时候，图片进入了可视区域再进行加载（修改src），这样可以显著的提高页面的加载速度，更少的图片并发请求数也可以减轻服务器的压力。如果用户仅仅在首屏停留，还可以节省流量。具体的实现方法可以看一个插件，就叫lazeload。

### 五.图标字体

用过bootstrap的同学肯定对方便的fontawesome图标字体印象深刻，可以无损放大缩小，可以修改颜色，只要加个类名就可以使用图标，感觉是不是很爽🌚。优势呢。。。矢量&方便好用，不过图标没有一定的量可能不大需要，而且矢量图可能美工压力也比较大，我们只要知道怎么用就行啦，有的时候用现成的图标减轻一下美工同学的工作量也是极好的。可以看一下一个专门用来做图标字体的网站。

[阿里UX矢量图标库–最强大的矢量图标库-Icon font制作力荐工具](http://www.w3cways.com/942.html)

### 六.svg

svg作为矢量图，和iconfont对比起来优势可能就是字体可能在样式修改方面受限较多，其次字体文件一般都弄的挺大的，然后兼容性差点。svg也可以认为就是图片，使用方法也很简单。

1.直接作为图片文件引入 

	<img src=“gblogo.svg” onerror=“this.onerror=null; this.src=”gblogo.png“”>
	//or css 
	background:url(gblogo.svg)

2.将svg代码拷到html文件里

	<g class=“logo” transform=“translate（0.000000，500.000000） scale（0.100000，-0.100000）” fill=“#000000” stroke=“none”>
	//本质上还是一个标签，可以定义样式
	.logo:hover{
		fill： #F08000;}

前端没啥问题，看美工愿不愿意做啦~😆